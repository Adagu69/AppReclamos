<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{FRAGMENTS/head :: head}">
</head>

<body class="layout-fixed sidebar-expand-lg bg-body-tertiary">
<div class="app-wrapper">

    <nav   th:replace="~{FRAGMENTS/navbar  :: navbar}"></nav>
    <aside th:replace="~{FRAGMENTS/sidebar :: sidebar}"></aside>

    <main class="app-main">
            <div class="container-fluid mt-4">

                <!-- ====== FORMULARIO ====== -->
                <form th:action="@{/admin/reclamos/guardar}" th:object="${reclamo}" method="post">

                    <div th:if="${#fields.hasGlobalErrors() or not #lists.isEmpty(globalErrors)}"
                         class="alert alert-danger" role="alert">
                        <p class="fw-bold mb-1">Por favor, corrija los siguientes errores:</p>
                        <ul>
                            <li th:each="err : ${globalErrors}" th:text="${err}"></li>
                            <li th:each="err : ${#fields.globalErrors()}" th:text="${err}"></li>
                        </ul>
                    </div>

                <input type="hidden" th:field="*{idReclamo}" />

                    <!-- ========= CLASIFICACIÓN DEL RECLAMO ========= -->
                    <div class="card card-primary mb-4">
                        <div class="card-header"><h3 class="card-title">Clasificación del Reclamo</h3></div>
                        <div class="card-body row g-3">

                            <div class="col-md-3">
                                <label for="periodoDeclaracion">Periodo de Declaración</label>
                                <input type="text" id="periodoDeclaracion" class="form-control"
                                       th:field="*{periodoDeclaracion}"
                                       placeholder="AAAAMM"
                                       pattern="\d{6}"
                                       maxlength="6"
                                       title="Ingrese el periodo en formato AAAAMM (ej. 202412)"
                                       required>
                                <div class="text-danger"
                                     th:if="${#fields.hasErrors('periodoDeclaracion')}"
                                     th:errors="*{periodoDeclaracion}">
                                </div>
                            </div>

                            <div class="col-md-4">
                                <label>Tipo de Declarante</label>
                                <select class="form-select" th:field="*{tipoDeclarante}" required>
                                    <option value="">-- Seleccione una opción --</option>
                                    <option th:each="d : ${T(com.AppReclamos.AppReclamosCms.Modelos.Enums.TipoDeclarante).values()}"
                                            th:value="${d}"
                                            th:text="${d.getGuiaUsuario()}"> </option>
                                </select>
                                <div class="text-danger"
                                     th:if="${#fields.hasErrors('tipoDeclarante')}"
                                     th:errors="*{tipoDeclarante}"></div>
                            </div>
                            <!-- 3. Código Declarante (numérico, hasta 8 dígitos, obligatorio) -->
                            <div class="col-md-3">
                                <label>Código Declarante</label>
                                <input type="text"
                                       class="form-control"
                                       th:field="*{codigoDeclarante}"
                                       pattern="\d{1,8}"
                                       maxlength="8"
                                       required>
                            </div>

                            <!-- 4. Código UGIPRESS (numérico, hasta 8 dígitos, obligatorio) -->
                            <div class="col-md-3">
                                <label>Código UGIPRESS</label>
                                <input type="text"
                                       class="form-control"
                                       th:field="*{codigoUgipress}"
                                       pattern="\d{1,8}"
                                       maxlength="8"
                                       required>
                            </div>

                            <div class="col-md-3">
                                <label>Tipo Institución</label>
                                <select class="form-select" th:field="*{tipoInstitucion}" required>
                                    <option value="">-- Seleccione --</option>
                                    <option th:each="i : ${T(com.AppReclamos.AppReclamosCms.Modelos.Enums.TipoInstitucion).values()}"
                                            th:value="${i}"
                                            th:text="${i.getGuiaUsuario()}"> </option>
                                </select>
                                <div class="text-danger" th:if="${#fields.hasErrors('tipoInstitucion')}" th:errors="*{tipoInstitucion}"></div>
                            </div>

                            <!-- 6. Código Institución (numérico, hasta 8 dígitos, obligatorio) -->
                            <div class="col-md-3">
                                <label>Código Institución</label>
                                <input type="text"
                                       class="form-control"
                                       th:field="*{codigoInstitucion}"
                                       pattern="\d{1,8}"
                                       maxlength="8"
                                       required>
                            </div>

                            <div class="col-md-3">
                                <label>Medio del Reclamo</label>
                                <select class="form-select" th:field="*{medioRecepcion}" required>
                                    <option value="">-- Seleccione --</option>
                                    <option th:each="m : ${T(com.AppReclamos.AppReclamosCms.Modelos.Enums.MedioRecepcion).values()}"
                                            th:value="${m}"
                                            th:text="${m.getGuiaUsuario()}">
                                    </option>
                                </select>
                                <div class="text-danger" th:if="${#fields.hasErrors('medioRecepcion')}" th:errors="*{medioRecepcion}"></div>
                            </div>

                            <!-- 8. Código Reclamo (alfanumérico, hasta 20 caracteres, obligatorio) -->
                            <div class="col-md-3">
                                <label>Código Reclamo</label>
                                <input type="text"
                                       class="form-control"
                                       th:field="*{codigoReclamo}"
                                       maxlength="20"
                                       required>
                            </div>

                        </div>
                    </div>

                    <!-- ===========================================================================
           BLOQUE 1: PERSONA – PRESENTANTE (personas[0])
           =========================================================================== -->
                    <div class="card card-secondary mb-4">
                        <div class="card-header">
                            <h3 class="card-title">Persona – Presentante</h3>
                        </div>
                        <div class="card-body row g-3">
                            <input type="hidden" th:field="*{presentante.idPersona}" />

                            <!-- Nombres -->
                            <div class="col-md-6">
                                <label>Nombres</label>
                                <input id="presentanteNombres" type="text" class="form-control" th:field="*{presentante.nombres}" required >
                                <div class="text-danger" th:if="${#fields.hasErrors('presentante.nombres')}" th:errors="*{presentante.nombres}"></div>
                            </div>

                            <!-- Ape. Paterno -->
                            <div class="col-md-3">
                                <label>Ape. Paterno</label>
                                <input id="presentanteApePaterno" type="text" class="form-control" th:field="*{presentante.apellidoPaterno}" required>
                                <div class="text-danger" th:if="${#fields.hasErrors('presentante.apellidoPaterno')}" th:errors="*{presentante.apellidoPaterno}"></div>
                            </div>

                            <!-- Ape. Materno -->
                            <div class="col-md-3">
                                <label>Ape. Materno</label>
                                <input id="presentanteApeMaterno" type="text" class="form-control" th:field="*{presentante.apellidoMaterno}" required>
                                <div class="text-danger" th:if="${#fields.hasErrors('presentante.apellidoMaterno')}" th:errors="*{presentante.apellidoMaterno}"></div>
                            </div>

                            <!-- Tipo Doc. -->
                            <div class="col-md-3">
                                <label>Tipo Doc.</label>
                                <select id="presentanteTipoDocumento" class="form-select" th:field="*{presentante.tipoDocumento}" required>
                                    <option value="">-- Seleccione --</option>
                                    <option th:each="d : ${T(com.AppReclamos.AppReclamosCms.Modelos.Enums.TipoDocumento).values()}"
                                            th:value="${d}"
                                            th:text="${d.getGuiaUsuario()}"> </option>
                                </select>
                                <div class="text-danger" th:if="${#fields.hasErrors('presentante.tipoDocumento')}" th:errors="*{presentante.tipoDocumento}"></div>
                            </div>

                            <!-- N.º Documento -->
                            <div class="col-md-3">
                                <label>N.º Documento</label>
                                <input id="presentanteNumeroDocumento" type="text" class="form-control" th:field="*{presentante.numeroDocumento}" required>
                                <div class="text-danger" th:if="${#fields.hasErrors('presentante.numeroDocumento')}" th:errors="*{presentante.numeroDocumento}"></div>
                            </div>

                            <!-- Razón Social (solo si es RUC) -->
                            <div class="col-md-6" id="razonSolPresentante" style="display:none;">
                                <label>Razón Social</label>
                                <input id="presentanteRazonSocial" type="text" class="form-control" th:field="*{presentante.razonSocial}">
                                <div class="text-danger" th:if="${#fields.hasErrors('presentante.razonSocial')}" th:errors="*{presentante.razonSocial}"></div>
                            </div>

                            <!-- Teléfono -->
                            <div class="col-md-3">
                                <label>Teléfono</label>
                                <input type="text" class="form-control" th:field="*{presentante.telefono}" maxlength="9" pattern="\d{9}" title="Ingrese un número de teléfono válido de 9 dígitos">
                            </div>

                            <!-- Email -->
                            <div class="col-md-3">
                                <label>Email</label>
                                <input type="email" class="form-control" th:field="*{presentante.correoElectronico}" maxlength="100" >
                                <div class="text-danger" th:if="${#fields.hasErrors('presentante.correoElectronico')}" th:errors="*{presentante.correoElectronico}"></div>
                            </div>

                            <!-- Domicilio -->
                            <div class="col-md-6">
                                <label>Domicilio</label>
                                <input type="text" class="form-control" th:field="*{presentante.domicilio}" maxlength="200">
                                <div class="text-danger" th:if="${#fields.hasErrors('presentante.domicilio')}" th:errors="*{presentante.domicilio}">
                                </div>
                            </div>

                            <!-- Resultado al correo -->
                            <div class="col-md-3">
                            <label>Resultado al correo</label>
                            <select class="form-select" th:field="*{presentante.resultadoPorCorreo}" required>
                                <option value="">-- Seleccione --</option>

                                <option th:each="rc : ${T(com.AppReclamos.AppReclamosCms.Modelos.Enums.ResultadoCorreo).values()}"
                                        th:value="${rc}"
                                        th:text="${rc.getGuiaUsuario()}">
                                </option>
                            </select>
                            <div class="text-danger" th:if="${#fields.hasErrors('presentante.resultadoPorCorreo')}" th:errors="*{presentante.resultadoPorCorreo}"></div>
                        </div>
                        </div>
                    </div>


                    <!-- ===========================================================================
                         BLOQUE 2: IDENTIFICACIÓN DEL USUARIO O TERCERO
                         =========================================================================== -->
                    <div class="card card-light mb-4">
                        <div class="card-header">
                            <h3 class="card-title">Identificación de Usuario / Tercero</h3>
                        </div>
                        <div class="card-body row g-3">
                            <input type="hidden" th:field="*{afectado.idPersona}" />

                            <!-- Tipo documento -->
                            <div class="col-md-3">
                                <label>Tipo Doc.</label>
                                <select id="afectadoTipoDocumento" class="form-select" th:field="*{afectado.tipoDocumento}" required>
                                    <option value="">-- Seleccione --</option>
                                    <option th:each="d : ${T(com.AppReclamos.AppReclamosCms.Modelos.Enums.TipoDocumento).values()}"
                                            th:value="${d}"
                                            th:text="${d.getGuiaUsuario()}"> </option>
                                </select>
                                <div class="text-danger" th:if="${#fields.hasErrors('afectado.tipoDocumento')}" th:errors="*{afectado.tipoDocumento}"></div>
                            </div>

                            <!-- Número del documento -->
                            <div class="col-md-3">
                                <label>N.º Documento</label>
                                <input id="afectadoNumeroDocumento" type="text" class="form-control" th:field="*{afectado.numeroDocumento}" required >
                                <div class="text-danger" th:if="${#fields.hasErrors('afectado.numeroDocumento')}" th:errors="*{afectado.numeroDocumento}"></div>
                            </div>

                            <!-- Nombres -->
                            <div class="col-md-3">
                                <label>Nombres</label>
                                <input id="afectadoNombres" type="text" class="form-control" th:field="*{afectado.nombres}" required >
                                <div class="text-danger" th:if="${#fields.hasErrors('afectado.nombres')}" th:errors="*{afectado.nombres}"></div>
                            </div>

                            <div class="col-md-3">
                                <label>Ape. Paterno</label>
                                <input id="afectadoApePaterno" type="text" class="form-control" th:field="*{afectado.apellidoPaterno}" >
                                <div class="text-danger" th:if="${#fields.hasErrors('afectado.apellidoPaterno')}" th:errors="*{afectado.apellidoPaterno}"></div>
                            </div>

                            <div class="col-md-3">
                                <label>Ape. Materno</label>
                                <input id="afectadoApeMaterno" type="text" class="form-control" th:field="*{afectado.apellidoMaterno}" >
                                <div class="text-danger" th:if="${#fields.hasErrors('afectado.apellidoMaterno')}" th:errors="*{afectado.apellidoMaterno}"></div>
                            </div>

                            <!-- Razón Social (solo si es RUC) -->
                            <div class="col-md-6" id="razonSolAfectado" style="display:none;">
                                <label>Razón Social</label>
                                <input id="afectadoRazonSocial" type="text" class="form-control" th:field="*{afectado.razonSocial}">
                                <div class="text-danger" th:if="${#fields.hasErrors('afectado.razonSocial')}" th:errors="*{afectado.razonSocial}"></div>
                            </div>

                        </div>
                    </div>

                    <!-- ========= DETALLE DEL RECLAMO ========= -->
                    <div class="card card-info mb-4">
                        <div class="card-header">
                            <h3 class="card-title">Detalle del Reclamo</h3>
                        </div>
                        <div class="card-body row g-3">
                            <!-- Oculto el id interno -->
                            <input type="hidden" th:field="*{detalles[0].idDetalle}" />

                            <!-- Medio de recepción del reclamo (obligatorio) -->
                            <div class="col-md-4">
                                <label>Medio de Presentación del Detalle</label>
                                <select id="medioPresentacionSelect" class="form-select" th:field="*{detalles[0].medioPresentacion}" required>
                                    <option value="">-- Seleccione --</option>
                                    <option th:each="m : ${T(com.AppReclamos.AppReclamosCms.Modelos.Enums.MedioPresentacion).values()}"
                                            th:value="${m}" th:text="${m.getGuiaUsuario()}"></option>
                                </select>
                            </div>

                            <!-- Fecha de recepción (obligatorio) -->
                            <div class="col-md-4"> <label>Fecha de recepción</label>
                                <input type="text"
                                       class="form-control"
                                       th:field="*{detalles[0].fechaRecepcion}"
                                       placeholder="AAAAMMDD"
                                       maxlength="8"
                                       pattern="^(20)\\d{6}$"
                                       title="Ingrese la fecha en formato AAAAMMDD (ej. 20250709)"
                                       required>
                                <div class="text-danger"
                                     th:if="${#fields.hasErrors('detalles[0].fechaRecepcion')}"
                                     th:errors="*{detalles[0].fechaRecepcion}"></div>
                            </div>

                            <!-- Descripción detallada (obligatorio, hasta 500 caracteres) -->
                            <div class="col-md-12">
                                <label>Detalle del reclamo</label>
                                <textarea rows="4"
                                          class="form-control"
                                          th:field="*{detalles[0].descripcion}"
                                          required
                                          maxlength="500"></textarea>
                                <div class="text-danger"
                                     th:if="${#fields.hasErrors('detalles[0].descripcion')}"
                                     th:errors="*{detalles[0].descripcion}"></div>
                            </div>
                        </div>
                    </div>

                    <!-- ========= GESTIÓN INTERNA ========= -->
                    <div class="card card-warning mb-4">
                        <div class="card-header bg-warning text-white">
                            <h3 class="card-title">Gestión interna</h3>
                        </div>
                        <div class="card-body row g-3">

                            <div class="col-md-4">
                                <label for="servicioSelect">Servicio de origen <span class="text-danger">*</span></label>
                                <select class="form-select" id="servicioSelect" th:field="*{gestion.servicio}" required>
                                    <option value="">– Seleccione –</option>

                                    <option th:each="s : ${T(com.AppReclamos.AppReclamosCms.Modelos.Enums.GestionServicios).values()}"
                                            th:value="${s}"
                                            th:text="${s.getGuiaUsuario()}">
                                    </option>
                                </select>
                                <div class="text-danger" th:if="${#fields.hasErrors('gestion.servicio')}" th:errors="*{gestion.servicio}"></div>
                            </div>

                            <div class="col-md-4">
                                <label for="competenciaSelect">Competencia <span class="text-danger">*</span></label>
                                <select class="form-select" id="competenciaSelect" th:field="*{gestion.competencia}" required>
                                    <option value="">– Seleccione –</option>

                                    <option th:each="c : ${T(com.AppReclamos.AppReclamosCms.Modelos.Enums.GestionCompetencia).values()}"
                                            th:value="${c}"
                                            th:text="${c.getGuiaUsuario()}">
                                    </option>
                                </select>
                                <div class="text-danger" th:if="${#fields.hasErrors('gestion.competencia')}" th:errors="*{gestion.competencia}"></div>
                            </div>

                            <div class="col-md-4">
                                <label for="estadoReclamoSelect">Estado del Reclamo <span class="text-danger">*</span></label>
                                <select class="form-select" id="estadoReclamoSelect" th:field="*{estado}" required>
                                    <option value="">– Seleccione –</option>

                                    <option th:each="e : ${T(com.AppReclamos.AppReclamosCms.Modelos.Enums.EstadoReclamo).values()}"
                                            th:value="${e}"
                                            th:text="${e.getGuiaUsuario()}">
                                    </option>
                                </select>
                                <div class="text-danger" th:if="${#fields.hasErrors('estado')}" th:errors="*{estado}"></div>
                            </div>

                            <div class="col-md-4 clasificaciones-group"
                                 th:classappend="${(reclamo.gestion?.competencia?.name() == 'SI' or reclamo.gestion?.competencia?.name() == 'COMPARTIDA')} ? '' : 'd-none'">
                                <label for="clasificacion1Input">Clasificación 1 <span class="text-danger clasificacion-required-mark">*</span></label>
                                <input type="text" class="form-control clasificacion-input"
                                       id="clasificacion1Input" th:field="*{gestion.clasificacion1}"
                                       maxlength="4">
                            </div>
                            <div class="col-md-4 clasificaciones-group"
                                 th:classappend="${(reclamo.gestion?.competencia?.name() == 'SI' or reclamo.gestion?.competencia?.name() == 'COMPARTIDA')} ? '' : 'd-none'">
                                <label for="clasificacion2Input">Clasificación 2 <span class="text-danger clasificacion-required-mark">*</span></label>
                                <input type="text" class="form-control clasificacion-input"
                                       id="clasificacion2Input" th:field="*{gestion.clasificacion2}"
                                       maxlength="4">
                            </div>
                            <div class="col-md-4 clasificaciones-group"
                                 th:classappend="${(reclamo.gestion?.competencia?.name() == 'SI' or reclamo.gestion?.competencia?.name() == 'COMPARTIDA')} ? '' : 'd-none'">
                                <label for="clasificacion3Input">Clasificación 3 <span class="text-danger clasificacion-required-mark">*</span></label>
                                <input type="text" class="form-control clasificacion-input"
                                       id="clasificacion3Input" th:field="*{gestion.clasificacion3}"
                                       maxlength="4">
                            </div>

                            <div class="col-md-6 codigo-primigenio-group"
                                 th:classappend="${(reclamo.estado?.name() == 'VERIFICACION' or reclamo.estado?.name() == 'CIERRE')} ? '' : 'd-none'">
                                <label for="codigoPrimigenioInput">Código Reclamo Primigenio <span class="text-danger primigenio-destino-required-mark">*</span></label>
                                <input type="text" class="form-control primigenio-destino-input"
                                       id="codigoPrimigenioInput" th:field="*{gestion.codigoPrimigenio}"
                                       maxlength="15">
                            </div>

                            <div class="col-md-4">
                                <label for="etapaSelect">Etapa del Reclamo <span class="text-danger">*</span></label>
                                <select class="form-select" id="etapaSelect" th:field="*{gestion.etapaReclamo}" required>
                                    <option value="">– Seleccione –</option>

                                    <option th:each="et : ${T(com.AppReclamos.AppReclamosCms.Modelos.Enums.GestionEtapa).values()}"
                                            th:value="${et}"
                                            th:text="${et.getGuiaUsuario()}">
                                    </option>
                                </select>
                                <div class="text-danger" th:if="${#fields.hasErrors('gestion.etapaReclamo')}" th:errors="*{gestion.etapaReclamo}"></div>
                            </div>



                            <div class="col-md-4 destino-group"
                                 th:classappend="${(reclamo.estado?.name() == 'TRASLADADO' || reclamo.estado?.name() == 'ACUMULADO') ? '' : 'd-none'}"> <label for="tipoDestinoSelect">Tipo de administrado destino <span class="text-danger primigenio-destino-required-mark">*</span></label>
                                <select class="form-select primigenio-destino-input" id="tipoDestinoSelect" th:field="*{gestion.tipoAdministraTraslado}">
                                    <option value="">– Seleccione –</option>

                                    <option th:each="td : ${T(com.AppReclamos.AppReclamosCms.Modelos.Enums.TipoDeclarante).values()}"
                                            th:value="${td}"
                                            th:text="${td.getGuiaUsuario()}">
                                    </option>
                                </select>
                            </div>

                            <div class="col-md-4 destino-group"
                                 th:classappend="${(reclamo.estado?.name() == 'VERIFICACION' or reclamo.estado?.name() == 'CIERRE')} ? '' : 'd-none'">
                                <label for="codigoDestinoInput">Código administrado destino <span class="text-danger primigenio-destino-required-mark">*</span></label>
                                <input type="text" class="form-control primigenio-destino-input"
                                       id="codigoDestinoInput" th:field="*{gestion.codigoAdministraTraslado}"
                                       pattern="\d{1,8}"
                                       maxlength="8">
                            </div>

                        </div>
                    </div>

                    <!-- =================  RESULTADO Y NOTIFICACIÓN  ================= -->
                    <div class="card card-success mb-4">
                        <div class="card-header"><h3 class="card-title">Resultado y notificación del reclamo</h3></div>
                        <div class="card-body row g-3">
                            <input type="hidden" th:field="*{resultados[0].id}" />

                            <div class="col-md-3">
                                <label for="fechaResultado" class="form-label">Fecha de Resultado</label>
                                <input type="text" id="fechaResultado" class="form-control"
                                       th:field="*{resultados[0].fechaResultado}"
                                       placeholder="AAAAMMDD" maxlength="8" pattern="^(20)\d{6}$"
                                       title="Ingrese la fecha en formato AAAAMMDD" required>
                                <div class="text-danger"
                                     th:if="${#fields.hasErrors('resultados[0].fechaResultado')}"
                                     th:errors="*{resultados[0].fechaResultado}"></div>
                            </div>

                            <div class="col-md-3">
                                <label for="resultadoReclamo" class="form-label">Resultado del Reclamo</label>
                                <select id="resultadoReclamo" class="form-select" th:field="*{resultados[0].resultado}" required>
                                    <option value="">-- Seleccione --</option>

                                    <option th:each="res : ${T(com.AppReclamos.AppReclamosCms.Modelos.Enums.ResultadoReclamo).values()}"
                                            th:value="${res}"
                                            th:text="${res.getGuiaUsuario()}">
                                    </option>
                                </select>
                                <div class="text-danger"
                                     th:if="${#fields.hasErrors('resultados[0].resultado')}"
                                     th:errors="*{resultados[0].resultado}"></div>
                            </div>

                            <div class="col-md-3">
                                <label for="motivoConclusion" class="form-label">Motivo de Conclusión Anticipada</label>
                                <select id="motivoConclusion" class="form-select"
                                        th:field="*{resultados[0].motivoConclusion}"
                                        disabled>
                                    <option value="">-- Seleccione un motivo --</option>

                                    <option th:each="mot : ${T(com.AppReclamos.AppReclamosCms.Modelos.Enums.MotivoConclusion).values()}"
                                            th:value="${mot}"
                                            th:text="${mot.getGuiaUsuario()}">
                                    </option>
                                </select>
                                <div class="text-danger"
                                     th:if="${#fields.hasErrors('resultados[0].motivoConclusion')}"
                                     th:errors="*{resultados[0].motivoConclusion}"></div>
                            </div>

                            <div class="col-md-3">
                                <label for="fechaNotificacion" class="form-label">Fecha de Notificación del Resultado</label>
                                <input type="text" id="fechaNotificacion" class="form-control"
                                       th:field="*{resultados[0].fechaNotificacion}"
                                       placeholder="AAAAMMDD" maxlength="8" pattern="^(20)\d{6}$"
                                       title="Ingrese la fecha en formato AAAAMMDD" required>
                                <div class="text-danger"
                                     th:if="${#fields.hasErrors('resultados[0].fechaNotificacion')}"
                                     th:errors="*{resultados[0].fechaNotificacion}"></div>
                            </div>

                            <div class="col-md-6">
                                <label for="comunicacionResultado" class="form-label">Comunicación del Resultado al Usuario</label>
                                <select id="comunicacionResultado" class="form-select"
                                        th:field="*{resultados[0].comunicacionResultado}"
                                        required>
                                    <option value="">-- Seleccione --</option>

                                    <option th:each="com : ${T(com.AppReclamos.AppReclamosCms.Modelos.Enums.ComunicacionResultado).values()}"
                                            th:value="${com}"
                                            th:text="${com.getGuiaUsuario()}">
                                    </option>
                                </select>
                                <div class="text-danger"
                                     th:if="${#fields.hasErrors('resultados[0].comunicacionResultado')}"
                                     th:errors="*{resultados[0].comunicacionResultado}"></div>
                            </div>

                        </div>
                    </div>

                    <!-- ========= BOTONES ========= -->
                    <div class="card-footer">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-arrow-right"></i> Guardar y Continuar a Medidas
                        </button>
                        <a th:href="@{/admin/reclamos}" class="btn btn-secondary">Cancelar</a>
                    </div>

                </form>
            </div>
    </main>


    <footer class="app-footer">
        <!--begin::To the end-->
        <div class="float-end d-none d-sm-inline">CMS</div>
        <!--end::To the end-->
        <!--begin::Copyright-->
        <strong>
            Copyright &copy; 2025&nbsp;
            <a href="#" class="text-decoration-none">CMS</a>.
        </strong>
        Todos los derechos reservados.
        <!--end::Copyright-->
    </footer>
    <!--end::Footer-->
</div>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<!-- ======= Script para mostrar/ocultar Razón Social ======= -->
<script>

    $(document).ready(function() {
        // --- SELECTORES ---
        const tipoDeclaranteSelect = $('#tipoDeclarante');
        const codigoDeclaranteInput = $('#codigoDeclarante');
        const codigoUgipressInput = $('#codigoUgipress');
        const tipoInstitucionSelect = $('#tipoInstitucion');
        const codigoInstitucionInput = $('#codigoInstitucion');
        const codigoReclamoInput = $('#codigoReclamo');

        // --- FUNCIÓN PARA VALIDAR CÓDIGO DECLARANTE Y UGIPRESS ---
        function actualizarValidacionDeclarante() {
            const tipoSeleccionado = tipoDeclaranteSelect.val();
            let pattern = "\\d+", maxlength = 8, placeholder = "Código", title = "Código es obligatorio.";

            switch (tipoSeleccionado) {
                case 'IPRESS':
                case 'UGIPRESS':
                    pattern = "\\d{8}"; maxlength = 8; placeholder = "8 dígitos"; title = "Debe ser de 8 dígitos.";
                    break;
                case 'IAFAS':
                    pattern = "\\d{5}"; maxlength = 5; placeholder = "5 dígitos"; title = "Debe ser de 5 dígitos.";
                    break;
            }
            codigoDeclaranteInput.attr({ pattern, maxlength, placeholder, title });

            if (tipoSeleccionado === 'UGIPRESS' || tipoSeleccionado === 'IAFAS') {
                codigoUgipressInput.val(codigoDeclaranteInput.val()).prop('readonly', true);
            } else {
                codigoUgipressInput.prop('readonly', false);
            }
        }

        // --- FUNCIÓN PARA VALIDAR CÓDIGO INSTITUCIÓN ---
        function actualizarValidacionInstitucion() {
            const tipoSeleccionado = tipoInstitucionSelect.val();
            let pattern = "\\d+", maxlength = 8, placeholder = "Código", title = "Código es obligatorio.";

            switch (tipoSeleccionado) {
                case 'IPRESS':
                case 'UGIPRESS':
                    pattern = "\\d{8}"; maxlength = 8; placeholder = "8 dígitos"; title = "Debe ser de 8 dígitos.";
                    break;
                case 'IAFAS':
                    pattern = "\\d{5}"; maxlength = 5; placeholder = "5 dígitos"; title = "Debe ser de 5 dígitos.";
                    break;
            }
            codigoInstitucionInput.attr({ pattern, maxlength, placeholder, title });
        }

        // --- FUNCIÓN PARA GENERAR CÓDIGO RECLAMO ---
        function generarCodigoReclamo() {
            const codigoAdmin = codigoDeclaranteInput.val();
            if (codigoAdmin) {
                // Para un reclamo nuevo, el correlativo podría ser '1'.
                // Para uno existente, este valor no debería cambiar.
                // Asumimos '1' para el ejemplo.
                const correlativo = "1"; // O podrías obtenerlo de otro campo si es necesario.
                codigoReclamoInput.val(`${codigoAdmin}-${correlativo}`);
            }
        }

        // --- LISTENERS ---
        tipoDeclaranteSelect.on('change', actualizarValidacionDeclarante);
        tipoInstitucionSelect.on('change', actualizarValidacionInstitucion);

        // Cuando el usuario escribe en Codigo Declarante, actualizamos UGIPRESS y Codigo Reclamo
        codigoDeclaranteInput.on('keyup', function() {
            const tipoSeleccionado = tipoDeclaranteSelect.val();
            if (tipoSeleccionado === 'UGIPRESS' || tipoSeleccionado === 'IAFAS') {
                codigoUgipressInput.val($(this).val());
            }
            generarCodigoReclamo();
        });

        // --- EJECUCIÓN INICIAL ---
        actualizarValidacionDeclarante();
        actualizarValidacionInstitucion();
        // No llamamos a generarCodigoReclamo() al inicio para no sobreescribir valores en modo edición.
    });



    $(document).ready(function() {

        /**
         * Función genérica para configurar la validación dinámica de una sección de persona (Presentante o Afectado).
         * @param {string} prefix - El prefijo para los IDs de los elementos HTML ('presentante' o 'afectado').
         */
        function configurarValidacionPersona(prefix) {
            // 1. Selectores de elementos usando el prefijo
            const tipoDocSelect = $(`#${prefix}TipoDocumento`);
            const numDocInput = $(`#${prefix}NumeroDocumento`);
            const razonSocialGroup = $(`#razonSol${prefix.charAt(0).toUpperCase() + prefix.slice(1)}`); // Ej: #razonSolPresentante
            const nombresGroup = $(`#${prefix}Nombres`).closest('.nombres-group');
            const apePaternoGroup = $(`#${prefix}ApePaterno`).closest('.nombres-group');
            const apeMaternoGroup = $(`#${prefix}ApeMaterno`).closest('.nombres-group');
            const razonSocialInput = razonSocialGroup.find('input');
            const nombresInput = nombresGroup.find('input');
            const paternoInput = apePaternoGroup.find('input');
            const maternoInput = apeMaternoGroup.find('input');

            // 2. Función principal que actualiza toda la sección
            function actualizarSeccion() {
                const tipoDoc = tipoDocSelect.val(); // Obtiene el nombre del enum, ej: "DNI", "RUC"
                let pattern = "\\d+", maxlength = "15", placeholder = "N.º Documento";

                // Criterios para Número de Documento
                switch (tipoDoc) {
                    case 'DNI':
                        pattern = "\\d{8}"; maxlength = "8"; placeholder = "8 dígitos";
                        break;
                    case 'CE':
                        pattern = "[a-zA-Z0-9]{9}"; maxlength = "9"; placeholder = "9 caracteres";
                        break;
                    case 'RUC':
                        pattern = "\\d{11}"; maxlength = "11"; placeholder = "11 dígitos";
                        break;
                }
                numDocInput.attr({ pattern, maxlength, placeholder });

                // Criterios para alternar entre Nombres y Razón Social
                const esRuc = (tipoDoc === 'RUC');

                razonSocialGroup.toggle(esRuc);
                razonSocialInput.prop('required', esRuc);

                // Usamos .add() para seleccionar y afectar todos los grupos de nombres a la vez
                nombresGroup.add(apePaternoGroup).add(apeMaternoGroup).toggle(!esRuc);
                nombresInput.add(paternoInput).add(maternoInput).prop('required', !esRuc);

                // Limpiar campos que se ocultan
                if (esRuc) {
                    nombresInput.val('');
                    paternoInput.val('');
                    maternoInput.val('');
                } else {
                    razonSocialInput.val('');
                }
            }

            // 3. Ejecutar al cargar la página y en cada cambio del select
            if (tipoDocSelect.length) {
                actualizarSeccion();
                tipoDocSelect.on('change', actualizarSeccion);
            }
        }

        // --- ¡AQUÍ ESTÁ LA MAGIA! ---
        // Llamamos a la misma función para ambas secciones
        configurarValidacionPersona('presentante');
        configurarValidacionPersona('afectado');


    });

    $(document).ready(function() {

        // --- SELECTORES ---
        const competenciaSelect = $('#competenciaSelect');
        const estadoReclamoSelect = $('#estadoReclamoSelect');

        // --- GRUPOS DE CAMPOS ---
        const clasificacionesGroup = $('.clasificaciones-group');
        const primigenioGroup = $('.primigenio-group');
        const destinoGroup = $('.destino-group');

        // --- FUNCIÓN GENÉRICA PARA MANEJAR GRUPOS ---
        function toggleFieldGroup(shouldShow, groupElement) {
            groupElement.toggle(shouldShow);
            groupElement.find('input, select').prop('required', shouldShow);
            if (!shouldShow) {
                groupElement.find('input, select').val('');
            }
        }

        // --- FUNCIONES DE LÓGICA ESPECÍFICA ---
        function actualizarClasificacionFields() {
            const competencia = competenciaSelect.val();
            const shouldShow = (competencia === 'SI' || competencia === 'COMPARTIDA');
            toggleFieldGroup(shouldShow, clasificacionesGroup);
        }

        function actualizarEstadoFields() {
            const estado = estadoReclamoSelect.val();
            // Lógica para Código Primigenio
            toggleFieldGroup(estado === 'ACUMULADO', primigenioGroup);
            // Lógica para Campos de Destino
            toggleFieldGroup(estado === 'TRASLADADO', destinoGroup);
        }

        // --- EJECUCIÓN INICIAL Y LISTENERS ---
        if (competenciaSelect.length) {
            actualizarClasificacionFields();
            competenciaSelect.on('change', actualizarClasificacionFields);
        }

        if (estadoReclamoSelect.length) {
            actualizarEstadoFields();
            estadoReclamoSelect.on('change', actualizarEstadoFields);
        }
    });

    document.addEventListener('DOMContentLoaded', function () {
        const resultadoReclamoSelect = document.getElementById('resultadoReclamo');
        const motivoConclusionSelect = document.getElementById('motivoConclusion');

        // Función para actualizar el estado del campo 'Motivo de Conclusión'
        function actualizarMotivoConclusion() {
            // El valor del enum en Java es 'Concluido_Anticipadamente'
            if (resultadoReclamoSelect.value === 'CONCLUIDO_ANTICIPADAMENTE') {
                motivoConclusionSelect.disabled = false;
                motivoConclusionSelect.required = true;
            } else {
                motivoConclusionSelect.disabled = true;
                motivoConclusionSelect.required = false;
                motivoConclusionSelect.value = ''; // Limpiar valor si se deshabilita
            }
        }

        // Ejecutar la función al cargar la página por si hay valores precargados
        actualizarMotivoConclusion();

        // Agregar un 'listener' para cuando cambie la selección
        resultadoReclamoSelect.addEventListener('change', actualizarMotivoConclusion);

        // --- Validaciones de Fechas ---
        const fechaResultadoInput = document.getElementById('fechaResultado');
        const fechaNotificacionInput = document.getElementById('fechaNotificacion');
        const hoy = new Date().toISOString().split('T')[0];

        // Establecer la fecha máxima como hoy
        fechaResultadoInput.max = hoy;
        fechaNotificacionInput.max = hoy;

        // Cargar fecha de notificación por defecto si es un reclamo nuevo
        /*[+
        var esNuevo = /*[[${esNuevo}]]* / (true); // Asume que pasas una variable 'esNuevo' desde el controlador
        if(esNuevo && !fechaNotificacionInput.value) {
           fechaNotificacionInput.value = hoy;
        }
        +]*/

        // Validar que la fecha de resultado no sea anterior a la de notificación
        fechaResultadoInput.addEventListener('change', function() {
            if (fechaResultadoInput.value < fechaNotificacionInput.value) {
                alert('La Fecha de Resultado no puede ser anterior a la Fecha de Notificación.');
                fechaResultadoInput.value = ''; // Limpiar valor incorrecto
            }
        });

        fechaNotificacionInput.addEventListener('change', function() {
            if (fechaResultadoInput.value && fechaResultadoInput.value < fechaNotificacionInput.value) {
                alert('La Fecha de Resultado no puede ser anterior a la Fecha de Notificación.');
                fechaNotificacionInput.value = fechaResultadoInput.value; // Opcional: revertir al valor de fecha resultado
            }
        });
    });
</script>
<script th:src="@{/js/bootstrap.bundle.min.js}"></script>
<script th:src="@{/js/adminlte.js}"></script>


</body>
</html>